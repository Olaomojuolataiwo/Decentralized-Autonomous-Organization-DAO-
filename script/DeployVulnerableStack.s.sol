// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Script.sol";
import "forge-std/console.sol";

import "../src/VulnerableMembershipToken.sol";
import "../src/TreasuryBasic.sol";
import "../src/VulnerableDAO.sol";

contract DeployVulnerableStack is Script {
    function run() external {
        address deployer = vm.envAddress("DEPLOYER");
        require(deployer != address(0), "DEPLOYER required");

        vm.startBroadcast();

        // 3) TreasuryBasic
        TreasuryBasic treasury = new TreasuryBasic(deployer);
        console.log("TreasuryBasic:", address(treasury));

        // 4) VulnerableDAO â€” Initializing the 120-member array

        // Step 1: Declare and initialize the list of addresses as a FIXED-SIZE array.
        address[120] memory fixedMembers = [
            // --- 100 Addresses from dao_addresses.txt ---
            0x4078ff1e54aD166CF5A690D061c961b1ccE9C050,
            0x4d9928F16E622630d26E3A5C3a81aff71a3bddCc,
            0x08ade12080ED1F86310FE7aBD63546b6BfFE7171,
            0x0abf5b0E1330e76A778232922b14E74222F35a9f,
            0x09654F74016eEfb83eCa874d4a7FCEa36D3E3889,
            0x19Da18d01Ad8348EBBd1E7BEbCc688dC0b76a2a7,
            0x6282A2932695d573B5aDB0fBE9d105cCB40Ef255,
            0xa977354D41F765927C0fEeC9338d08430B8d06Fd,
            0xb2d91f32172fB7FBDfb1db23f0D4aD94Eb273666,
            0x0353296Ce9bAA09DB7E64f5bd88879852F9dE5B5,
            0x934b673EA39e0BE01e4A962E82fC962627234c69,
            0xE5fDD1E8B5306c444C1E94E20714C516Bb676814,
            0x02e37D830deE08d2E81477E021fE4041C75afc24,
            0x96338B76088BA1a1f20748903DF985A59dBD5584,
            0x7b4b7E2b793DF904A4f63f75AaD1a806B8A6ce5e,
            0x76481631981c539a90BeB6a2a83d5be3EAd8E5A9,
            0x5EfF7EE8A2d60A9f11Fa0016c831cFE5a91405B7,
            0xc32769C6142A7925064f1F6bD60bbed58DD0aB97,
            0xDbC54961F9Fea3D9de34077e8A19500907c3E004,
            0xc247B675936A601d1cA637b009757605d869a5C2,
            0x172c6E38430c72978C3c774629493ac452Dba91b,
            0xec7F8f246AFDDb3524964aAB0b0a73de5EaC753B,
            0x00DAE40CC4113985bE16B7a74838817977BCBC96,
            0xDa31f3a4d78B340009421f6BBB38cF07eAaF5C94,
            0xaf27748Ef58abF61F4a751ed8bEEACaa0859BB18,
            0x6a710F0109EA2213CAEE899f89b6F8614B080e16,
            0x0Af39Bdf71e654Ff34BE34Fd71D43bFBEB0D3850,
            0xb5503e3C6D69d1817421b8a090Eb3ee2307eC39b,
            0x054Eef752B06F3eE99712A45Fa65EdC14B21ccD7,
            0x140F6E30A7442c4e2b66e4ed72193e178e592645,
            0x4593ca4ef3F44B1ACFEaA9C63Fb375CBf46DAF4E,
            0xa16F23e8e074e3c92769633734FF5d5bC0AbBa3F,
            0x1eAC291d0FB5bb0f98F2d5073Bd460d8A084C499,
            0x42375a5C3812DE48799cCcec8694C70AD3906D32,
            0xf0A20f108AF982AAFBf5f017d449d7CAbF9843E5,
            0xE6FA4F1f07E50C71D20A18939cd0f15F57b993E3,
            0xb6846A4b5a16d12b21283d372356A78f9d695a99,
            0x74e357903d5322591230faA1176b62c9b8D8991b,
            0x9bd71dB81FDdCa79A8E0C7e802D2a4860f68DEA9,
            0x948240e6E38aB218771c1ff9de0B43E7993894c1,
            0xFb05d61Ac7D105787d714c694F8F09A99B0fC73D,
            0xE75aA58bd8ff07E2743Cd06f5F2A1d91B6E35a16,
            0x01B25605A454614619053fA91Fcd3B75dDbd4dED,
            0x14e2087673fdc70ca0c4A3C0ADFbc65d1CA42b2D,
            0x4aA9eD3440BA3d98ABbbC9cae1923D89f912A0b2,
            0xA594b0d3dA87e923ED7A2EEDE66AF4d71D392bdB,
            0x5c7A1d39d676F3C685208e0B8586b96054df1e39,
            0xe88B2d405AA81a4B3D6CcFB6420B02797aee9141,
            0x98b1fD43dfc7647C8C7e440DEcEBa124256258fF,
            0x637Acb6db3eD35A5c8ddE2298009c4C1Ea9b762C,
            0xFec8D4C75adCF1261Ec3D0d47a055a35Ba5b7e01,
            0x0181CbC997651bb8bBA8b6fA24BAE7cF9Eb0F660,
            0xF060f937aEd66BD691891bE391E86610248E5287,
            0x2039417F312E857C14915Ed93ABD00CF57A8aa2A,
            0x630Dba671C1a3a4Fb8D2BDa85919ECe32F442E4e,
            0xb8A8d245f52E31e5d2fc64D579452E0164912564,
            0x72B8334Fa83A0045CfEFa8832177E7bb12C4DFd1,
            0xD3cc5AC58F1795097b809EeddECF03107984332E,
            0x9edaee052aA9988799f0Ba21E77FC74AF2389624,
            0x2918CE396C3Bbbaa2cF1CF8dF81C484d8fa705D1,
            0xD2E215A3bA54254037E88554BeF6cc458c651Ebb,
            0xc226C287CDdC50684EAf0720b3921B2868B7c5D5,
            0x1bA560A8D907CC55b93a29DACC61416A93EdD8DA,
            0x807abe82AD296dA6d564E611e03ba3E0c6dE0139,
            0xEcb88E4f1E4F75DEEc233Aed313f35bBaFFd332c,
            0x360D531e432d6F1c9293B1f03A7eaF8473c827C5,
            0xCaeA867936299E9129901bFCE5D8Ef44eE0cB1c6,
            0x67a586b192F94fbb8FBecF8A1Bc94011e0c4B2d9,
            0x984bF84F8e63B99660c1f026C7f82B611cEa3a9E,
            0x10BDa6687d8068C75E0a2d80811A5533F7F04c48,
            0x2A7A216421da092A301590Aefc2a71d9Fa1C5379,
            0xBCa9567B322B8A555d36899bd2673b490D747A82,
            0x430C9cbF2d151cD93C80C149d7482aEC0dFadF24,
            0xC34d43d411b000268D8A4bb4B3778843d6f2FB97,
            0xb2d59ce2D2bd4C02bab3d92a2fB2128ad225a0C8,
            0xaD1D948E00117D8Eaf1F7EfAB61417Ad2e13C27a,
            0x4d16e5c80db660119B046772ABf41FE3046b23BE,
            0xB612e56095D2f3Cb30344024aD0ebb6B6278D2cf,
            0x4D08D27c8223312e0e2A509487580ccBe59c15B0,
            0xfD3E1755Ce654a7AF8cECC6F9B77E47476c3D76e,
            0x02c83000e5AE0445F0e49B27C28b983A31E35140,
            0xFB0fa6c140B31f29e156464123D69Eb7153Cd899,
            0x3bc052BaAFCA295c1Ea245a49d3Bef724A922F8C,
            0xb312A8F3a9F366C7d8DC7489946c17B3D07AafAC,
            0x36CD252C76FB9fd355cC9F61eB7B892BD7793f8b,
            0x11F4a334A76E49884cb74EA1d3bBB214fBc7A1C7,
            0x6C3E9f65928ca54Ff5b80a8662F640A1794F5f52,
            0x94B2FBbFe5370215463A2727Ab42FE46461246c7,
            0xA5565CFBe2580102db0b25404c9Cc7A1EdEA7684,
            0x6a8666a8556057909F53054a344465fE5A43c898,
            0x2d02c6F5D33a0C95542C1f13854241C76253cF22,
            0x64c022EbF0807B65cD5C5cb94d524B5CC2e2B884,
            0xd8Db70aD9984003A285c65797a073b5c6EeA2FAa,
            0xf7896a4bCD79647E61b1609BD13948e8F0Fd5dA4,
            0xE49c9a52DE0f91a5735AE3A05a27422195CC32B4,
            0x8aE9Df37699D9B4361ac9c3B6F4C7A85fa60FF8C,
            0xC2A170F9B5bacA2a831303C9F7227D44f37c957f,
            0x35063b9a49970ca4d30491BB71777CE4Df8a1457,
            0x031C398B4B7EA0cdE3e6B36dC39C23AB9D83A437,
            0xc77931CB325993d2B5EcfB6222Ecbcfd1DB47F4D,
            0x11FD392efc009123E1e5d252af2cAbb5D9a429EC,
            0x38fC67f717CF0BA5E6cB0471C1EADB432AFf1045,
            0xe26a61fbFc3bd8Ec0D3D1D04ba6da92f5f73cD6b,
            0x727b62a52f44dA1a1D404FE00DCbD412701E1654,
            0x475611A3E64B528938A18EA624Bb163F25C6335A,
            0x5003f1E73Dffa4fb68D1fE1bA541Ca6bbe867B90,
            0x3FfC5d4D80D12d472c0fC454d04C51Aa4E13AEeA,
            0xf77F99AB8c143f08F2f9c19a8055fd4A2eB3F43D,
            0xAf26D4016A789724062553dBB71dc607814e1372,
            0x3f2Bb6e6e8c3fa274cAec05bEbdAEcC7186Cdf6c,
            0x57d10Ca32A1cf65F111e0A3c93fF7E39EF28884c,
            0x1E7f3daD93131bC302b0A58d9B0674edc4b1a577,
            0x62b9c072937191779eF041c44cebe1eDA521C5Fd,
            0xD70d0AAfA744326410CD18B48bFD184b9cbE8bFA,
            0xe994a47c15C9aACF7C849429986731d52Dd27B35,
            0x10Cf79C333fb10EDb45784052ff8dC7B5228159f,
            0x1b90505051c6bEED5F65A39E9f7aFbeBA1B9eb14,
            0xdba96965D54AEC894A0C9802D05F9eFCef31A578,
            0x2A9d9FEc804Bb91a32b578533Aa06278395B6B90,
            0xf32cC4FB298d522884042D974ed41CD5805CE17d
        ];

        // Step 2: Create the target DYNAMIC-SIZE array with the correct length
        address[] memory members = new address[](fixedMembers.length);

        // Step 3: Explicitly copy elements over to perform the required type conversion
        for (uint256 i = 0; i < fixedMembers.length; i++) {
            members[i] = fixedMembers[i];
        }

        // Ensure you update this address with your *existing* token's address
        address EXISTING_TOKEN_ADDRESS = 0x40515b13F02A82762Cc99E67500e86E1De2385Fd; // <<< UPDATE THIS

        VulnerableDAO dao = new VulnerableDAO(EXISTING_TOKEN_ADDRESS, members);
        console.log("VulnerableDAO:", address(dao));

        vm.stopBroadcast();
    }
}
